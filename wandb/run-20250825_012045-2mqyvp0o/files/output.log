***** Running training *****
08/25/2025 01:20:47 - INFO - utils.data_utils -   ***** Running training *****
  Num examples = 11995
08/25/2025 01:20:47 - INFO - utils.data_utils -     Num examples = 11995
  Dataloader size = 1500
08/25/2025 01:20:47 - INFO - utils.data_utils -     Dataloader size = 1500
  Resume training from step 0
08/25/2025 01:20:47 - INFO - utils.data_utils -     Resume training from step 0
  Instantaneous batch size per device = 1
08/25/2025 01:20:47 - INFO - utils.data_utils -     Instantaneous batch size per device = 1
  Total train batch size (w. data & sequence parallel, accumulation) = 32.0
08/25/2025 01:20:47 - INFO - utils.data_utils -     Total train batch size (w. data & sequence parallel, accumulation) = 32.0
  Gradient Accumulation steps = 4
08/25/2025 01:20:47 - INFO - utils.data_utils -     Gradient Accumulation steps = 4
  Total optimization steps per epoch = 300
08/25/2025 01:20:47 - INFO - utils.data_utils -     Total optimization steps per epoch = 300
  Total training parameters per FSDP shard = 1.491297992 B
08/25/2025 01:20:47 - INFO - utils.data_utils -     Total training parameters per FSDP shard = 1.491297992 B
  Master weight dtype: torch.bfloat16
08/25/2025 01:20:47 - INFO - utils.data_utils -     Master weight dtype: torch.bfloat16
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:14<00:00,  1.11it/s]
08/25/2025 01:21:01 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:14<00:00,  1.53it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.53it/s]
08/25/2025 01:21:13 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:21:24 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.53it/s]
08/25/2025 01:21:35 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
gathered_reward {'ctr_reward': [], 'ecp_reward': [], 't2i_reward': [], 'hps_reward': tensor([0.0674, 0.0698, 0.0706, 0.0688, 0.0238, 0.0225, 0.0280, 0.0271, 0.0640,
        0.0599, 0.0580, 0.0580, 0.0256, 0.0246, 0.0243, 0.0276, 0.0776, 0.0796,
        0.0801, 0.0769, 0.0205, 0.0180, 0.0191, 0.0175, 0.0755, 0.0782, 0.0786,
        0.0786, 0.0783, 0.0769, 0.0779, 0.0830], device='cuda:0')}
idx i:  0
ratio: 1.00
08/25/2025 01:22:02 - INFO - utils.data_utils -   ratio: 1.00
advantage -1.2744
08/25/2025 01:22:02 - INFO - utils.data_utils -   advantage -1.2744
final loss: 0.0354
08/25/2025 01:22:02 - INFO - utils.data_utils -   final loss: 0.0354
idx i:  1
ratio: 1.00
08/25/2025 01:22:27 - INFO - utils.data_utils -   ratio: 1.00
advantage 0.4987
08/25/2025 01:22:27 - INFO - utils.data_utils -   advantage 0.4987
final loss: -0.0139
08/25/2025 01:22:27 - INFO - utils.data_utils -   final loss: -0.0139
idx i:  2
ratio: 1.00
08/25/2025 01:22:53 - INFO - utils.data_utils -   ratio: 1.00
advantage 1.0306
08/25/2025 01:22:53 - INFO - utils.data_utils -   advantage 1.0306
final loss: -0.0286
08/25/2025 01:22:53 - INFO - utils.data_utils -   final loss: -0.0286
idx i:  3
grad_norm_
ratio: 1.00
08/25/2025 01:23:18 - INFO - utils.data_utils -   ratio: 1.00
advantage -0.2549
08/25/2025 01:23:18 - INFO - utils.data_utils -   advantage -0.2549
final loss: 0.0071
08/25/2025 01:23:18 - INFO - utils.data_utils -   final loss: 0.0071
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:23:29 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:23:40 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:23:51 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:24:02 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
gathered_reward {'ctr_reward': [], 'ecp_reward': [], 't2i_reward': [], 'hps_reward': tensor([0.0688, 0.0717, 0.0699, 0.0692, 0.0468, 0.0469, 0.0509, 0.0498, 0.0577,
        0.0587, 0.0533, 0.0487, 0.0746, 0.0707, 0.0704, 0.0747, 0.0424, 0.0431,
        0.0394, 0.0406, 0.0648, 0.0646, 0.0610, 0.0688, 0.0985, 0.1016, 0.1044,
        0.1074, 0.0437, 0.0586, 0.0543, 0.0446], device='cuda:0')}
idx i:  0
ratio: 1.00
08/25/2025 01:24:28 - INFO - utils.data_utils -   ratio: 1.00
advantage -0.8694
08/25/2025 01:24:28 - INFO - utils.data_utils -   advantage -0.8694
final loss: 0.0241
08/25/2025 01:24:28 - INFO - utils.data_utils -   final loss: 0.0241
idx i:  1
ratio: 1.00
08/25/2025 01:24:54 - INFO - utils.data_utils -   ratio: 1.00
advantage 1.4007
08/25/2025 01:24:54 - INFO - utils.data_utils -   advantage 1.4007
final loss: -0.0389
08/25/2025 01:24:54 - INFO - utils.data_utils -   final loss: -0.0389
idx i:  2
ratio: 1.00
08/25/2025 01:25:20 - INFO - utils.data_utils -   ratio: 1.00
advantage 0.0000
08/25/2025 01:25:20 - INFO - utils.data_utils -   advantage 0.0000
final loss: 0.0000
08/25/2025 01:25:20 - INFO - utils.data_utils -   final loss: 0.0000
idx i:  3
grad_norm_
ratio: 1.00
08/25/2025 01:25:45 - INFO - utils.data_utils -   ratio: 1.00
advantage -0.5313
08/25/2025 01:25:45 - INFO - utils.data_utils -   advantage -0.5313
final loss: 0.0148
08/25/2025 01:25:45 - INFO - utils.data_utils -   final loss: 0.0148
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:25:56 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:26:07 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.53it/s]
08/25/2025 01:26:18 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.53it/s]
08/25/2025 01:26:29 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
--> decode image and save to log dir...
gathered_reward {'ctr_reward': [], 'ecp_reward': [], 't2i_reward': [], 'hps_reward': tensor([0.0736, 0.0718, 0.0793, 0.0652, 0.0710, 0.0752, 0.0693, 0.0769, 0.0754,
        0.0795, 0.0807, 0.0757, 0.0623, 0.0645, 0.0578, 0.0585, 0.0435, 0.0406,
        0.0438, 0.0395, 0.0183, 0.0270, 0.0263, 0.0206, 0.0574, 0.0597, 0.0611,
        0.0611, 0.0278, 0.0264, 0.0277, 0.0256], device='cuda:0')}
idx i:  0
ratio: 1.00
08/25/2025 01:26:55 - INFO - utils.data_utils -   ratio: 1.00
advantage 0.1935
08/25/2025 01:26:55 - INFO - utils.data_utils -   advantage 0.1935
final loss: -0.0054
08/25/2025 01:26:55 - INFO - utils.data_utils -   final loss: -0.0054
idx i:  1
ratio: 1.00
08/25/2025 01:27:21 - INFO - utils.data_utils -   ratio: 1.00
advantage -0.1203
08/25/2025 01:27:21 - INFO - utils.data_utils -   advantage -0.1203
final loss: 0.0033
08/25/2025 01:27:21 - INFO - utils.data_utils -   final loss: 0.0033
idx i:  2
ratio: 1.00
08/25/2025 01:27:47 - INFO - utils.data_utils -   ratio: 1.00
advantage 1.1769
08/25/2025 01:27:47 - INFO - utils.data_utils -   advantage 1.1769
final loss: -0.0327
08/25/2025 01:27:47 - INFO - utils.data_utils -   final loss: -0.0327
idx i:  3
grad_norm_
ratio: 1.00
08/25/2025 01:28:12 - INFO - utils.data_utils -   ratio: 1.00
advantage -1.2502
08/25/2025 01:28:12 - INFO - utils.data_utils -   advantage -1.2502
final loss: 0.0347
08/25/2025 01:28:12 - INFO - utils.data_utils -   final loss: 0.0347
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:28:23 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:28:34 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:28:45 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
Sampling Progress: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.54it/s]
08/25/2025 01:28:56 - INFO - utils.data_utils -   --> decode image and save to log dir...███████████████████████████████████████████████████████████████| 16/16 [00:10<00:00,  1.55it/s]
--> decode image and save to log dir...
gathered_reward {'ctr_reward': [], 'ecp_reward': [], 't2i_reward': [], 'hps_reward': tensor([0.0708, 0.0717, 0.0722, 0.0675, 0.0431, 0.0496, 0.0461, 0.0470, 0.0878,
        0.0903, 0.0844, 0.0887, 0.0559, 0.0531, 0.0611, 0.0543, 0.0553, 0.0568,
        0.0512, 0.0585, 0.0594, 0.0630, 0.0537, 0.0592, 0.0532, 0.0533, 0.0595,
        0.0625, 0.0475, 0.0522, 0.0585, 0.0527], device='cuda:0')}
idx i:  0
ratio: 1.00
08/25/2025 01:29:22 - INFO - utils.data_utils -   ratio: 1.00
advantage 0.1154
08/25/2025 01:29:22 - INFO - utils.data_utils -   advantage 0.1154
final loss: -0.0032
08/25/2025 01:29:22 - INFO - utils.data_utils -   final loss: -0.0032
Traceback (most recent call last):
  File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 1446, in <module>
    main(args)
  File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 1092, in main
    loss, grad_norm = train_one_step(
  File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 875, in train_one_step
    loss.backward()
  File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/_tensor.py", line 626, in backward
    torch.autograd.backward(
  File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/autograd/__init__.py", line 347, in backward
    _engine_run_backward(
  File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/autograd/graph.py", line 823, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 1446, in <module>
[rank0]:     main(args)
[rank0]:   File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 1092, in main
[rank0]:     loss, grad_norm = train_one_step(
[rank0]:   File "/root/autodl-tmp/DiffusionGRPO/src/train_grpo_flux.py", line 875, in train_one_step
[rank0]:     loss.backward()
[rank0]:   File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/_tensor.py", line 626, in backward
[rank0]:     torch.autograd.backward(
[rank0]:   File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/autograd/__init__.py", line 347, in backward
[rank0]:     _engine_run_backward(
[rank0]:   File "/root/miniconda3/envs/aigc_rl/lib/python3.10/site-packages/torch/autograd/graph.py", line 823, in _engine_run_backward
[rank0]:     return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
[rank0]: KeyboardInterrupt
